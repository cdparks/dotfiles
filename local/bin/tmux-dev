#!/bin/bash

# Silent pushd
pushd() {
  command pushd "$@" > /dev/null
}

# Silent popd
popd() {
  command popd > /dev/null
}

# Send keys as a comment
comment_keys() {
  tmux send-keys -t"$1" -l "# $2"
  tmux send-keys -t"$1" Enter
}

if [ -n "$1" ];
then
  printf "tmux-dev [--help|-h]\n"
  printf "\n"
  printf "Opens the following windows:\n"
  printf " 0: code\n"
  printf " 1: dotfiles\n"
  printf " 2: scratch\n"
  printf "\n"
  exit 2
fi

# code pane
pushd "$HOME/code"
tmux new-session -s "dev" -n "code" -d
comment_keys dev:0 "Run these later"
comment_keys dev:0 "aws ecr get-login-password | docker login --username AWS --password-stdin <instance>"
comment_keys dev:0 "docker system prune --all --volumes # (note: destructive)"
comment_keys dev:0 "docker-compose pull"
comment_keys dev:0 "docker-compose down"
comment_keys dev:0 "docker-compose up -d"
comment_keys dev:0 "docker-compose logs --tail=30 -f postgres"
popd

# dotfiles pane
pushd "$HOME/dotfiles"
tmux new-window -t dev:1 -n "dotfiles"
popd

# scratch pane
pushd "$HOME"
tmux new-window -t dev:2 -n "scratch"
popd

# Start in code pane
tmux select-window -t dev:0

# Actually attach to session
tmux -2 attach-session -t dev
